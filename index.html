<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8" />
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        #planContainer {
            position: relative;
            border: 1px solid #ccc;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            height: 1000px;
            margin-top: 1rem;
        }

        .pin {
            position: absolute;
            border-radius: 50%;
            color: white;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            font-weight: bold;
            font-size: 10px;
            cursor: pointer;
        }
    </style>
</head>

<body class="p-4">

    <h3>üìç ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</h3>

    <div class="mb-3">
        <label for="imageUpload" class="form-label">üñºÔ∏è ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏õ‡∏•‡∏ô:</label>
        <input type="file" id="imageUpload" accept="image/*" class="form-control" />
    </div>

    <div class="mb-3">
        <label for="pinType" class="form-label">üé® ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡∏°‡∏∏‡∏î:</label>
        <select id="pinType" class="form-select">
            <option value="Green">‡∏£‡∏≠‡∏¢‡∏£‡πâ‡∏≤‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡∏°. (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô)</option>
            <option value="orange">‡∏£‡∏≠‡∏¢‡∏£‡πâ‡∏≤‡∏ß‡∏°‡∏≤‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏°. (‡∏™‡πâ‡∏°)</option>
            <option value="red">‡∏£‡∏≠‡∏¢‡∏£‡πâ‡∏≤‡∏ß‡∏ó‡∏∞‡∏•‡∏∏ (‡πÅ‡∏î‡∏á)</option>
            <option value="blue">‡∏ù‡πâ‡∏≤‡πÄ‡∏û‡∏î‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡∏°. (‡∏ü‡πâ‡∏≤)</option>
            <option value="purple">‡∏ù‡πâ‡∏≤‡πÄ‡∏û‡∏î‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ß‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏°. (‡∏°‡πà‡∏ß‡∏á‡πÅ‡∏î‡∏á)</option>
        </select>
    </div>

    <div class="mb-3">
        <button id="undoBtn" class="btn btn-warning">‚Ü©Ô∏è ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button id="saveImage" class="btn btn-success">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πá‡∏ô PNG</button>
    </div>

    <!-- üî≤ ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
    <div id="captureArea">
        <div id="planContainer"></div>

        <h5 class="mt-4">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏∏‡∏î‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</h5>
        <ul id="summaryList" class="list-group w-50 mb-3"></ul>
        <p><strong>üìå ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="totalPins">0</span> ‡∏à‡∏∏‡∏î</strong></p>
    </div>

    <!-- html2canvas ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        const planContainer = document.getElementById('planContainer');
        const imageUpload = document.getElementById('imageUpload');
        const pinType = document.getElementById('pinType');
        const undoBtn = document.getElementById('undoBtn');
        const saveImageBtn = document.getElementById('saveImage');
        const summaryList = document.getElementById('summaryList');
        const totalPinsDisplay = document.getElementById('totalPins');

        let pinCount = 0;
        let pins = [];

        const colorMap = {
            Green: '‡∏£‡∏≠‡∏¢‡∏£‡πâ‡∏≤‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡∏°.',
            orange: '‡∏£‡∏≠‡∏¢‡∏£‡πâ‡∏≤‡∏ß‡∏°‡∏≤‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏°.',
            red: '‡∏£‡∏≠‡∏¢‡∏£‡πâ‡∏≤‡∏ß‡∏ó‡∏∞‡∏•‡∏∏',
            blue: '‡∏ù‡πâ‡∏≤‡πÄ‡∏û‡∏î‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ß‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡∏°.',
            purple: '‡∏ù‡πâ‡∏≤‡πÄ‡∏û‡∏î‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ß‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏°.',
        };

        imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    planContainer.style.backgroundImage = `url(${event.target.result})`;
                };
                reader.readAsDataURL(file);
            }
        });

        planContainer.addEventListener('click', (e) => {
            const rect = planContainer.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const color = pinType.value;
            pinCount++;

            const pin = document.createElement('div');
            pin.classList.add('pin');
            pin.style.left = `${x - 10}px`;
            pin.style.top = `${y - 10}px`;
            pin.style.backgroundColor = color;
            pin.innerText = pinCount;

            planContainer.appendChild(pin);

            pins.push({ id: pinCount, x, y, type: color, element: pin });
            updateSummary();
        });

        undoBtn.addEventListener('click', () => {
            if (pins.length === 0) return;

            const lastPin = pins.pop();
            planContainer.removeChild(lastPin.element);
            pinCount--;
            updateSummary();
        });

        function updateSummary() {
            const summary = {};
            pins.forEach(p => {
                summary[p.type] = (summary[p.type] || 0) + 1;
            });

            summaryList.innerHTML = '';
            for (const type in summary) {
                const li = document.createElement('li');
                li.className = "list-group-item d-flex justify-content-between align-items-center";
                li.innerHTML = `<span style="color:${type}; font-weight: bold;">‚óè</span> ${colorMap[type]} <span class="badge bg-secondary rounded-pill">${summary[type]}</span>`;
                summaryList.appendChild(li);
            }

            totalPinsDisplay.textContent = pins.length;
        }

        saveImageBtn.addEventListener('click', () => {
            html2canvas(document.querySelector("#captureArea")).then(canvas => {
                const link = document.createElement("a");
                link.download = "‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏£‡∏∏‡∏õ.png";
                link.href = canvas.toDataURL("image/png");
                link.click();
            });
        });
    </script>

</body>

</html>
